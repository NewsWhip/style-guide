<div>
    <h2 class="page-header">Charts</h2>

    <form [formGroup]="form">
        <div formArrayName="selectedMetrics" style="display: flex; flex-direction: row;">
            <div class="checkbox" style="margin-right: 8px;" *ngFor="let metric of form.controls.selectedMetrics.controls; let i = index">
                <input id="metric-{{i}}" type="checkbox" [formControlName]="i">
                <label for="metric-{{i}}">
                    {{metricNames[i]}}
                </label>
            </div>
        </div>
    </form>

    <div style="display: flex; flex-direction: row;">
        <svg nw-chart
            [width]="600"
            [height]="400"
            [margins]="chartMargins"
            (nwMousemove)="onMousemove($event)"
            (nwMouseout)="onMouseout()">

            <!-- Axes -->
            <g class="x axis nw-slot-2" nw-x-axis
                [domain]="xDomain"
                [scale]="xScale"
                [tickFormat]="xAxisTickFormat"
                [tickCount]="8"></g>

            <g class="y axis nw-slot-2" nw-y-axis
                [domain]="yDomain"
                [scale]="yScale"
                [tickFormat]="yAxisTickFormat"
                [showGuidlines]="true"></g>

            <g class="y axis random-axis nw-slot-2" nw-y-axis align="right"
                [domain]="randomYDomain"
                [scale]="yScale"
                [tickCount]="4"
                [showGuidlines]="yDomain[0] === 0 && yDomain[1] === 0"></g>

            <!-- Hover lines -->
            <!-- <path class="hover-path nw-slot-1" *ngIf="isHovering"
                [nw-path]="[[hoverCoordinates[0], yDomain[0]], [hoverCoordinates[0], yDomain[1]]]"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                [animDuration]="0"></path>

            <path class="hover-path nw-slot-1" *ngIf="isHovering"
                [nw-path]="[[xDomain[0], hoverCoordinates[1]], [xDomain[1], hoverCoordinates[1]]]"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                [animDuration]="0"></path> -->

            <!-- Paths -->
            <path class="fb-comments" *ngIf="isMetricSelected('fbComments')"
                [nw-path]="getDataByMetric('fbComments')"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                (animEnd)="onPathAnimationEnd('fbComments')"></path>

            <path class="tw-shares" *ngIf="isMetricSelected('twShares')"
                [nw-path]="getDataByMetric('twShares')"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <path class="fb-total" *ngIf="isMetricSelected('fbTotalEngagement')"
                [nw-path]="getDataByMetric('fbTotalEngagement')"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <path class="random"
                [nw-path]="randomData"
                [xDomain]="xDomain"
                [yDomain]="randomYDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <!-- Circles with popovers -->
            <ng-container *ngIf="isMetricSelected('fbComments')">
                <circle *ngFor="let point of getDataByMetric('fbComments'); trackBy:circleTrackValue"
                    [nw-circle]="point"
                    [xDomain]="xDomain"
                    [yDomain]="yDomain"
                    [xScale]="xScale"
                    [yScale]="yScale"
                    r=5
                    [popover]="circlePopTemplate"
                    [popoverContext]="{ point: point }"
                    container="body"
                    [outsideClick]="true"></circle>
            </ng-container>

            <circle *ngFor="let point of randomData; trackBy:circleTrackIndex"
                [nw-circle]="point"
                [xDomain]="xDomain"
                [yDomain]="randomYDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                r=5
                [popover]="circlePopTemplate"
                [popoverContext]="{ point: point }"
                container="body"
                [outsideClick]="true"></circle>
        </svg>

        <ng-template #circlePopTemplate let-point="point">
            <p>{{point[0] | date: 'medium'}}</p>
            <strong>{{point[1] | number: '1.0-0'}}</strong>
        </ng-template>

        <div *ngIf="isHovering" style="margin-left: 16px;">
            <h3 class="nw-text nw-text-light">Hover data</h3>
            <hr>
            <p class="nw-text nw-text-light">
                {{hoverCoordinates[0] | date: 'medium'}}
            </p>
            <p class="nw-text nw-text-light">
                {{hoverCoordinates[1] | number: '1.0-0'}}
            </p>
        </div>
    </div>

    <button class="btn btn-md btn-primary" (click)="generateRandomData()">Randomise</button>

    <!-- RESPONSIVE GRAPH -->

    <!-- <div class="row">
        <div class="col-sm-6">
            <div class="chart-container">
                <svg nw-chart
                    [xDomain]="xDomain"
                    [yDomain]="yDomain"
                    [margins]="chartMargins">

                    <path class="fb-comments" *ngIf="isMetricSelected('fbComments')"
                        [nw-path]="getDataByMetric('fbComments')"
                        (animEnd)="onPathAnimationEnd('fbComments')"></path>

                    <path class="tw-shares" *ngIf="isMetricSelected('twShares')"
                        [nw-path]="getDataByMetric('twShares')"></path>

                    <path class="fb-total" *ngIf="isMetricSelected('fbTotalEngagement')"
                        [nw-path]="getDataByMetric('fbTotalEngagement')"></path>

                    <g class="x axis" nw-x-axis></g>
                    <g class="y axis" nw-y-axis></g>
                </svg>
            </div>
        </div>
        <div class="col-sm-6"></div>
    </div> -->
</div>
