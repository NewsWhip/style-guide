<div>
    <h2 class="page-header">Charts</h2>

    <form [formGroup]="form">
        <div formArrayName="selectedMetrics" style="display: flex; flex-direction: row;">
            <div class="checkbox" style="margin-right: 8px;" *ngFor="let metric of form.controls.selectedMetrics.controls; let i = index">
                <input id="metric-{{i}}" type="checkbox" [formControlName]="i">
                <label for="metric-{{i}}">
                    {{metricNames[i]}}
                </label>
            </div>
        </div>
    </form>

    <div style="display: flex; flex-direction: row;">
        <svg nw-chart nw-brush
            [width]="600"
            [height]="400"
            [margins]="chartMargins"
            (nwMousemove)="onMousemove($event)"
            (nwMouseout)="onMouseout()">

            <g nw-brush *ngIf="showBrush.value"
                [width]="600"
                [height]="400"
                [dimension]="brushType.value"
                (brushEnd)="onBrushSelection($event)"></g>

            <!-- Axes -->
            <g class="x axis nw-slot-2" nw-x-axis
                [width]="600"
                [height]="400"
                [domain]="xDomain"
                [scale]="xScale"
                [tickFormat]="xAxisTickFormat"
                [tickCount]="8"></g>

            <g class="y axis nw-slot-2" nw-y-axis
                [width]="600"
                [height]="400"
                [domain]="yDomain"
                [scale]="yScale"
                [tickFormat]="yAxisTickFormat"
                [showGuidlines]="true"></g>

            <g class="y axis random-axis nw-slot-2" nw-y-axis align="right"
                [width]="600"
                [height]="400"
                [domain]="randomYDomain"
                [scale]="yScale"
                [tickCount]="4"
                [showGuidlines]="yDomain[0] === 0 && yDomain[1] === 0"></g>

            <!-- Hover lines -->
            <path class="hover-path nw-slot-1" *ngIf="isHovering"
                [nw-path]="[[mainScaleHoverCoordinates[0], yDomain[0]], [mainScaleHoverCoordinates[0], yDomain[1]]]"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                [animDuration]="0"></path>

            <path class="hover-path nw-slot-1" *ngIf="isHovering"
                [nw-path]="[[xDomain[0], mainScaleHoverCoordinates[1]], [xDomain[1], mainScaleHoverCoordinates[1]]]"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                [animDuration]="0"></path>

            <!-- Paths -->
            <path class="fb-comments" *ngIf="isMetricSelected('fbComments')"
                [nw-path]="getDataByMetric('fbComments')"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                (animEnd)="onPathAnimationEnd('fbComments')"></path>

            <path class="tw-shares" *ngIf="isMetricSelected('twShares')"
                [nw-path]="getDataByMetric('twShares')"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <path class="fb-total" *ngIf="isMetricSelected('fbTotalEngagement')"
                [nw-path]="getDataByMetric('fbTotalEngagement')"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="yDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <path class="random"
                [nw-path]="randomData"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="randomYDomain"
                [xScale]="xScale"
                [yScale]="yScale"></path>

            <!-- Circles with popovers -->
            <ng-container *ngIf="isMetricSelected('fbComments')">
                <circle *ngFor="let point of getDataByMetric('fbComments'); trackBy:circleTrackValue"
                    [nw-circle]="point"
                    [width]="600"
                    [height]="400"
                    [xDomain]="xDomain"
                    [yDomain]="yDomain"
                    [xScale]="xScale"
                    [yScale]="yScale"
                    r=5
                    [popover]="circlePopTemplate"
                    [popoverContext]="{ point: point }"
                    container="body"
                    [outsideClick]="true"></circle>
            </ng-container>

            <circle *ngFor="let point of randomData; trackBy:circleTrackIndex"
                [nw-circle]="point"
                [width]="600"
                [height]="400"
                [xDomain]="xDomain"
                [yDomain]="randomYDomain"
                [xScale]="xScale"
                [yScale]="yScale"
                r=5
                [popover]="circlePopTemplate"
                [popoverContext]="{ point: point }"
                container="body"
                [outsideClick]="true"></circle>
        </svg>

        <ng-template #circlePopTemplate let-point="point">
            <p>{{point[0] | date: 'medium'}}</p>
            <strong>{{point[1] | number: '1.0-0'}}</strong>
        </ng-template>

        <div style="margin-left: 16px;">
            <div class="checkbox">
                <input type="checkbox" [formControl]="showBrush" id="show-brush">
                <label for="show-brush">Show brush</label>
            </div>

            <ng-container *ngIf="showBrush.value">
                <div class="radio">
                    <input type="radio" [formControl]="brushType" id="brush-type-both" value="">
                    <label for="brush-type-both">Both</label>
                </div>
                <div class="radio">
                    <input type="radio" [formControl]="brushType" id="brush-type-x" value="x">
                    <label for="brush-type-x">X</label>
                </div>
                <div class="radio">
                    <input type="radio" [formControl]="brushType" id="brush-type-y" value="y">
                    <label for="brush-type-y">Y</label>
                </div>

                <div *ngIf="brushBox">
                    <h5 class="nw-text">X Range</h5>
                    <p>
                        {{brushBox[0][0] | date:'medium'}} - {{brushBox[1][0] | date:'medium'}}
                    </p>

                    <h5 class="nw-text">Y Range</h5>

                    <p>
                        {{brushBox[1][1] | number: '1.0-0'}} - {{brushBox[0][1] | number: '1.0-0'}}
                    </p>
                </div>
            </ng-container>
        </div>

        <div *ngIf="isHovering" style="margin-left: 16px;">
            <h3 class="nw-text nw-text-light">Hover data</h3>
            <hr>
            <p class="nw-text nw-text-light">
                {{mainScaleHoverCoordinates[0] | date: 'medium'}}
            </p>
            <p class="nw-text nw-text-light">
                {{mainScaleHoverCoordinates[1] | number: '1.0-0'}}
            </p>

            <hr>

            <p class="nw-text nw-text-light">
                {{randomScaleHoverCoordinates[0] | date: 'medium'}}
            </p>
            <p class="nw-text nw-text-light">
                {{randomScaleHoverCoordinates[1] | number: '1.0-0'}}
            </p>
        </div>
    </div>

    <button class="btn btn-md btn-primary" (click)="generateRandomData()">Randomise</button>

</div>
